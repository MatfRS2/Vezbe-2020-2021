# Вежбе -- Четврти час -- Креирање _tag-helper_-a, основе тестирања и рад са компонентама

[повратак](../../README.md)

**Наставак унапређивања и додавања нових функционалности интернет продавници.**

**Задатак:** На страни коју посматра корисник су приказани сви производи који постоје у бази. Желимо да изменимо приказ тако да на свакој страни буде приказано **_n_** производа и да корисник лако може да се креће по странама и прегледа све производе. Направити навигацију тако да корисник може да прегледа различите категорије производа.

### Почетни кораци:

- У _ProizvodController.cs_ додаје се параметар _VelicinaStrane_ којим се задаје колико производа се приказује на свакој страни.
- Мења се метод _Spisak_ (_Resenje1_ у коментарима) коме се додаје додатни параметар _tekucaStrana_ на основу ког се врши исписивање производа
- Приликом покретања да би се приступило другој страни производа: `https://localhost:broj/?tekucaStrana=2`

### Tag helpers:

- [Документација](https://docs.microsoft.com/en-us/aspnet/core/mvc/views/tag-helpers/authoring?view=aspnetcore-3.0)
- Желимо да омогућимо да корисник може да кликне на линк који га води ка другој, трећој... страни производа (а не да ручно куца адресу)
- За ту сврху ћемо креирати _tag helper_
- _Tag helper_ приликом превођења мењају HTML елементе у погледу (view)
- Постоје уграђени (и неке ћемо и ми користити)
- А могу се писати и сопствени _tag helper_-и. 
- _Tag helper_-и се смештају у `Infrastructure/TagHelpers` фолдер.
- У пројекту је креиран _PageLinkTagHelpers_ -- погледати ову класу и обратити пажњу на коментаре који објашњавају сваки део кода.
- У _Spisak.cshtml_ се додаје: `<div model-strane="@Model.ModelStrane" akcija="Spisak"></div>`. Када се преведе биће замењен са `<a href...` таговима (погледати `inspect element` у браузеру)

### View Models:

- Поред класа којима се моделују подаци, понекад су потребне класе које моделују оно што се преноси у погледе (_razor_ странице).
- У овом примеру направљене су две такве класе: _PodaciZaPrikazStrane_ и _SpisakProizvodaViewModel_
- Класа _PodaciZaPrikazStrane_ се користи да се у њу сместе подаци потребни за _tag helper_ који је написан (погледати коментаре у коду)
- Класа _SpisakProizvodaViewModel_ се користи да би се _razor_ страници _Spisak_ пренели сви потребни подаци (низ производа + _PodaciZaPrikazStrane_)
- Мења се метод _Spisak_ (_Resenje2_ у коментарима) и _razor_ страници се прослеђују мало другачији параметри

### Стилизовање _tag helper_-а
- Да би _tag helper_ могао да се користи потребно га је регистровати. То значи да је потребно у _ViewImports_ укључити написане _tag helper_-е.
- Да би додали стил, потребно је додати поља у класу _PageLinkTagHelpers_: _KlasaElementa_, _KlasaElementaNormalno_ и _KlasaElementaSelektovano_
- Да би руте лепо изгледале обратити пажњу на промене у _Startup.cs_ и позиву _MapRoute_


## Тестирање

- Важан део сваког пројекта је и тестирање. Са развојем кода требало би паралелено развијати тестове. 
- Креирање UnitTest: `Add->New Project -->xUnitTest`
- Задати ново име и одабрати `Add to this solution`.
- Десни клик на име пројекта па `Manage NuGet Packages`, одабрати `Moq` и `Install`.
- Десни клик па `Add --> Reference` и онда одабрати жељени пројекат (обратити пажњу на измене у `.csproj` фајлу).
- Погледати примере тестова: _UnitTest1_ и _ProizvodControllerTests_
- Тестирати: `Test--> Test Explorer --> Run`


## Парцијални погледи
- [Документација](https://docs.microsoft.com/en-us/aspnet/core/mvc/views/partial?view=aspnetcore-3.0)
- Понекад је згодно део _razor_ странице издвојити у посебан поглед да би се смањила комплексност и да би могао део кода више пута да се користи. 
- Парцијални поглед се смешта у _Shared_ фолдер. На пример, у овом пројекту је стављен у `Views/Proizvod/Shared/_ProizvodIspis.cshtml`
- Парцијални поглед се може лако уметнути у текућу страницу коришћњем уграђеног _tag helper_-а: `partial` (погледати `Spisak.cshtml`)
- Потребни подаци могу бити прослеђени коришћењем атрибута `for` 

## Додавање навигације:

### Почетни кораци

- У _SpisakProizvodaViewModel_ додати _TrenutnaKategorija_
- Изменити метод _Spisak_ који сада филтрира производе и према категорији (у методи додати још једно поље _trenutnaKategorija_)
- Покренути и пробати `https://localhost:5001/Proizvod/?trenutnaKategorija=racunar`
- Потом променити изглед рута у `Startup.cs`:
	- увек се прво наводи најдужа рута (у нашем примеру то је рута облика `../kategroija/stranaBr`, нпр. `https://localhost:5001/Proizvod/racunar/Strana2`)
	- на крају се наводи најопштија могућа рута
	- погледати коментаре у коду у `Startup.cs`
	- више о рута у [документацији](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/routing?view=aspnetcore-3.0)

### Коришћење _ViewComponent_ ради додавања навигације

- Више о _ViewComponent_, као и разни примери могу се видети у [документацији](https://docs.microsoft.com/en-us/aspnet/core/mvc/views/view-components?view=aspnetcore-3.0).
- Направити фолдер _Components_, а у њему _NavigacijaViewComponent_
- Додати метод _Invoke_
- Креирати _Razor_ страницу за приказ комоненте: `Views/Shared/Components/Navigacija/Default.cshtml`. Називи су битни и путања мора да изгледа овако. (подразумеване путање се могу променити у конфигурацији)
- У _\_Layout.cshtml_ позвати компоненту са _@await_
- Обележавање тренутне категорије у навигацији: компоненти је (поред низа категорија) неопходно проследити и тренутну категорију. Направити _NavigacijaViewModel_ и изменити _Invoke_.

[повратак](../../README.md)